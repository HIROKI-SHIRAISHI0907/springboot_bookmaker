<div class='container mt-3 mb-5'>
   <h1 class='text-left mb-5'>掲示板詳細</h1>

   <div class="d-flex justify-content-between align-items-center mb-3">
      <%= link_to "一覧", all_posts_path, class: "btn btn-outline-secondary" %>
      <%= link_to "編集", edit_post_path(@detail), class: "btn btn-outline-secondary" %>
      <!-- サインイン,サインアウトへ -->
      <% if logged_in? %>
         <%= button_to "サインアウト", logout_path, method: :delete, class: "btn btn-outline-danger" %>
      <% else %>
         <%= link_to "サインイン", login_path, class: "btn btn-outline-secondary" %>
      <% end %>
   </div>

   <div class='coll-md-6 mx-auto mb5'>
      <div class='card mb-4 shadow-sm'>
         <% d = @detail %>

         <div class='card-header'>
            <%# 作成者,タイトル %>
            <p><%= d.name %></p>
            <h2><%= d.title %></h2>
         </div>
         <div class='card-body'>
            <%# 本文 %>
            <div class="d-block p-2 text-bg-dark">
               <%= d.body %>
            </div>
            <%# 作成日時 %>
            <div class="d-block p-2 text-bg-dark">
               <%= d.created_at.strftime("%Y年%m月%d日") %>
            </div>
            <%# 更新日時 %>
            <div class="d-block p-2 text-bg-dark">
               <%= d.updated_at.strftime("%Y年%m月%d日") %>
            </div>
         </div>

         <div class='card-footer'>
            <%# 作成者,タイトル %>
            <p>コメント</p>
            <div class="list-group mt-3">
               <% if @comments&.any? %>
                  <% @comments.each do |c| %>
                  <div class="list-group-item" id="comment-<%= c.commentid %>">
                     <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1"><%= c.userid %></h6>
                        <small class="text-muted"><%= l(c.created_at, format: :short) %></small>
                     </div>
                     <p class="mb-1"><%= c.comment %></p>
                     <div class="d-flex justify-content-end gap-2">
                        <!-- /posts/:postid/detailなので、postidをパラメータとして引き渡す -->
                        <%= button_to "削除", comment_path(c.commentid), method: :delete, class: "btn btn-outline-danger btn-sm" %>
                     </div>
                  </div>
                  <% end %>
               <% else %>
                  <div class="list-group-item text-muted text-center">
                     コメントはまだありません
                  </div>
               <% end %>
            </div>
         </div>
      </div>
   </div>
</div>

<div class="container mt-3">
   <%= form_for @comment, url: comment_post_path do |f| %> <%# @XXXはcontroller側のnewでインスタンス生成しておく必要がある%>
      <div class="row g-2 align-items-center">
         <%# Post.detailで呼び出された@detail.postidで投稿IDをhiddenしておく。コメントテーブルに登録するため%>
         <%= f.hidden_field :postid, value: @detail.postid %>
      <!-- 名前 -->
         <div class="col-auto">
            <%= f.text_field :userid, value: 'UNKNOWN', readonly: true, class: 'form-control' %>
         </div>

         <!-- 内容 -->
         <div class="col">
            <%= f.text_field :comment, placeholder: '内容', class: 'form-control' %>
         </div>

         <!-- 投稿ボタン -->
         <div class="col-auto">
            <%= f.button '投稿', class: 'btn btn-primary' %>
         </div>
      </div>
   <% end %>
</div>
